{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load l10n %}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

  <!-- Tombol Create Product -->
  {% if user.is_authenticated %}
  <div class="mb-6">
    <button onclick="showModal('create')" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
      Create Product
    </button>
  </div>
  {% endif %}

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

    {% for product in products %}
    <article class="bg-white rounded-lg border border-gray-200 hover:shadow-lg transition-shadow duration-300 overflow-hidden">

      <!-- Thumbnail -->
      <div class="aspect-[16/9] relative overflow-hidden">
        {% if product.thumbnail %}
        <a href="{% url 'main:show_product' product.pk %}">
          <img src="{{ product.thumbnail }}" alt="{{ product.name }}" class="w-full h-full object-cover">
        </a>
        {% else %}
        <div class="w-full h-full bg-gray-200"></div>
        {% endif %}

        <!-- Category Badge -->
        <div class="absolute top-3 left-3">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium {{ product.get_category_display|category_color_class }}">
            {{ product.category }}
          </span>
        </div>

        <!-- Status Badges -->
        <div class="absolute top-3 right-3 flex space-x-2">
          {% if product.is_featured %}
          <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-800">
            Featured
          </span>
          {% endif %}
        </div>
      </div>

      <!-- Content -->
      <div class="p-5">
        <h3 class="text-lg font-semibold text-gray-900 mb-3 line-clamp-2 leading-tight">
          <a href="{% url 'main:show_product' product.pk %}" class="hover:text-green-600 transition-colors">
            {{ product.name }}
          </a>
        </h3>

        <p class="text-gray-600 text-sm leading-relaxed line-clamp-3 mb-4">
          {{ product.description|truncatewords:20 }}
        </p>

        <p class="text-lg font-semibold leading-relaxed line-clamp-3 mb-4">
          Rp {{ product.price|localize }}
        </p>

        <!-- Action Buttons -->
        {% if user.is_authenticated and product.user == user %}
        <div class="flex items-center justify-between pt-4 border-t border-gray-100">
          <a href="{% url 'main:show_product' product.pk %}" class="text-green-600 hover:text-green-700 font-medium text-sm transition-colors">
            Read more
          </a>
          <div class="flex space-x-2">
            <!-- Edit Product (AJAX Modal) -->
            <a href="javascript:void(0)"
               class="text-gray-600 hover:text-gray-800 text-sm transition-colors"
               onclick="showModal('edit', {
                   id: {{ product.id }},
                   name: '{{ product.name|escapejs }}',
                   price: {{ product.price }},
                   description: '{{ product.description|escapejs }}',
                   thumbnail: '{{ product.thumbnail|default_if_none:'' }}',
                   category: '{{ product.category }}',
                   is_featured: {{ product.is_featured|yesno:'true,false' }}
               })">
               Edit
            </a>

            <!-- Delete Product -->
            <a href="{% url 'main:delete_product' product.pk %}" class="text-red-600 hover:text-red-800 text-sm transition-colors">
              Delete
            </a>
          </div>
        </div>
        {% else %}
        <div class="pt-4 border-t border-gray-100">
          <a href="{% url 'main:show_product' product.pk %}" class="text-green-600 hover:text-green-700 font-medium text-sm transition-colors">
            Read more â†’
          </a>
        </div>
        {% endif %}
      </div>

    </article>
    {% endfor %}
  </div>
</div>
